# タイマー評価アプリ - サブスクリプション仕様書

## 概要

このドキュメントでは、タイマー評価アプリにおける無料版とプレミアム版の機能分類、価格設定案、実装方針を定義します。

---

## 基本方針

### ビジネス目標
1. **無料版で価値を提供**: 基本的な評価機能は無料で使える
2. **プロフェッショナル向けにプレミアム**: 業務で頻繁に使うユーザーに追加価値を提供
3. **公平な価格設定**: 月額料金は利用価値に見合ったもの
4. **無料トライアル**: プレミアム機能を試してから購入できる

### ターゲットユーザー
- **無料版**: 学生、実習生、個人利用、稀に使う医療従事者
- **プレミアム版**: 臨床で日常的に使用するセラピスト、看護師、医療機関

---

## 機能分類案

### ✅ 無料版（Free Tier）

#### コア機能
- [x] **評価者の管理**
  - 1名の評価者アカウント作成・編集・削除
  - 評価者情報の基本管理

- [x] **対象者の管理**
  - 最大3名まで対象者を登録可能
  - 対象者の追加・編集・削除

- [x] **評価項目の管理**
  - 各対象者に最大5項目まで評価項目を登録可能
  - 評価項目の追加・編集・削除

- [x] **タイマー測定機能**
  - 高精度タイマー（Start/Stop/Reset）
  - 測定結果の保存（各評価項目につき最大10件まで）

- [x] **基本的な過去データ閲覧**
  - 過去の測定結果一覧表示
  - 日付順での並び替え
  - 個別データの削除

- [x] **基本的な共有機能**
  - 1件ずつのデータコピー
  - 1件ずつの共有

- [x] **基本設定**
  - アプリ共有機能
  - レビュー依頼
  - お問い合わせ

#### 無料版の制限まとめ
| 項目 | 制限 |
|------|------|
| 評価者数 | 1名 |
| 対象者数 | 最大3名 |
| 評価項目数/対象者 | 最大5項目 |
| 保存可能な測定結果数/評価項目 | 最大10件 |
| データエクスポート | 不可 |
| 統計・グラフ | 不可 |
| 複数選択・一括操作 | 不可 |
| バックアップ | 不可 |

---

### 🌟 プレミアム版（Premium Tier）

#### 無料版の全機能 + 以下の追加機能

#### 1. 拡張データ管理
- [x] **無制限の評価者**
  - 複数の評価者アカウント作成可能
  - チームでの使用に最適

- [x] **無制限の対象者**
  - 対象者数の制限なし
  - 大規模施設での運用可能

- [x] **無制限の評価項目**
  - 各対象者に何項目でも評価項目を設定可能
  - 詳細な評価が可能

- [x] **無制限の測定結果保存**
  - 過去の測定データを無制限に保存
  - 長期間の経過観察が可能

#### 2. 高度な分析・表示機能
- [ ] **統計機能** ⭐ 新規実装
  - 平均値、最小値、最大値、標準偏差の表示
  - 改善率の計算
  - 期間別の統計（週間、月間、年間）

- [ ] **グラフ表示** ⭐ 新規実装
  - 折れ線グラフで経過を可視化
  - 複数評価項目の比較グラフ
  - 期間を指定してのグラフ表示

- [x] **高度なソート機能**
  - タイム順（速い順/遅い順）でのソート
  - カスタムソート

#### 3. 効率化機能
- [x] **複数選択・一括操作** ✅ 実装済み
  - 複数データの選択
  - 一括コピー
  - 一括共有
  - 一括削除

- [ ] **評価項目テンプレート** ⭐ 新規実装
  - よく使う評価項目セットの保存
  - ワンタップで評価項目セットを適用
  - テンプレートのカスタマイズ

- [ ] **クイック測定モード** ⭐ 新規実装
  - 対象者・評価項目を事前選択
  - 連続して複数の評価を素早く実施

#### 4. データ管理機能
- [ ] **データエクスポート** ⭐ 新規実装
  - CSV形式でのエクスポート
  - PDF形式でのレポート出力
  - メールやクラウドへの直接送信

- [ ] **データバックアップ** ⭐ 新規実装
  - iCloud自動バックアップ
  - データの復元機能
  - デバイス間でのデータ同期

- [ ] **データインポート** ⭐ 新規実装
  - CSV形式からのインポート
  - 他デバイスからのデータ移行

#### 5. カスタマイズ機能
- [ ] **テーマカラー変更** ⭐ 新規実装
  - 複数のカラーテーマから選択
  - ダークモード最適化

- [ ] **メモ機能** ⭐ 新規実装
  - 各測定にメモを追加
  - 写真の添付（オプション）

#### 6. その他プレミアム特典
- [ ] **広告なし** ⭐ 今後追加予定
  - 無料版に広告を追加した場合に適用

- [ ] **優先サポート** ⭐ 新規実装
  - 専用のサポートチャンネル
  - 迅速な問い合わせ対応

---

## 実装フェーズ分け

### Phase 1: 基本的な制限実装（必須）
**目標**: 無料版とプレミアム版の基本的な区別

1. **サブスクリプション管理基盤**
   - RevenueCat SDK初期化
   - サブスクリプション状態の管理
   - Paywall画面の実装

2. **無料版の数量制限**
   - 評価者: 1名まで
   - 対象者: 3名まで
   - 評価項目: 5項目/対象者まで
   - 測定結果: 10件/評価項目まで

3. **UI/UX改善**
   - 制限到達時のアラート表示
   - プレミアムアップグレード促進画面
   - 「プレミアムで解除」バッジ表示

4. **レストア機能**
   - 購入の復元機能

### Phase 2: データ操作の拡張（優先度: 高）
**目標**: プレミアムユーザーの生産性向上

1. **複数選択・一括操作** ✅ 実装済み
   - 複数データ選択UI
   - 一括コピー
   - 一括共有
   - 一括削除

2. **データエクスポート**
   - CSV出力機能
   - PDF出力機能
   - 共有シート統合

### Phase 3: 分析・可視化機能（優先度: 中）
**目標**: データから洞察を得る

1. **統計機能**
   - 基本統計量の計算
   - 統計表示画面

2. **グラフ機能**
   - Charts ライブラリ統合
   - 折れ線グラフ表示
   - インタラクティブなグラフ

### Phase 4: 効率化・カスタマイズ（優先度: 中）
**目標**: ワークフロー改善

1. **テンプレート機能**
   - テンプレート作成・管理
   - テンプレート適用

2. **クイック測定モード**
   - ショートカット機能

3. **メモ機能**
   - メモ追加UI
   - メモ表示・編集

### Phase 5: バックアップ・同期（優先度: 低）
**目標**: データの安全性とデバイス間連携

1. **iCloudバックアップ**
   - 自動バックアップ
   - 復元機能

2. **データ同期**
   - デバイス間同期

---

## 価格設定案

### サブスクリプションプラン

#### プラン1: 月額サブスクリプション
- **価格**: ¥480 / 月
- **無料トライアル**: 7日間
- **特徴**: いつでもキャンセル可能

#### プラン2: 年間サブスクリプション
- **価格**: ¥3,600 / 年（月額換算 ¥300）
- **割引率**: 月額プランより37.5% OFF
- **無料トライアル**: 7日間
- **特徴**: 長期利用でお得

#### プラン3: 買い切り（オプション）
- **価格**: ¥8,800（一度の支払い）
- **特徴**: 永久ライセンス、今後の機能追加も含む
- **メリット**: サブスク不要、長期利用ユーザー向け

### 価格設定の根拠
- **競合調査**: 医療系アプリの平均価格帯（¥400-¥600/月）
- **ターゲット**: 月に数回以上使用する医療従事者
- **価値提供**: 業務効率化による時間節約（1回あたり数分）
- **無料版との差別化**: 実用的な制限で無料版も使えるが、プロユースはプレミアム必須

### App Store Connect設定
```
Product ID: premium_monthly
Product ID: premium_yearly
Product ID: premium_lifetime (オプション)

Subscription Group: Premium Features
```

---

## 実装の技術的詳細

### 1. サブスクリプション状態管理

#### SubscriptionManager クラス
```swift
final class SubscriptionManager {
    static let shared = SubscriptionManager()

    private(set) var isPremium: Bool = false

    enum Entitlement: String {
        case premium = "premium"
    }

    func configure() {
        // RevenueCat初期化
        Purchases.configure(withAPIKey: "YOUR_REVENUECAT_API_KEY")
        checkSubscriptionStatus()
    }

    func checkSubscriptionStatus() {
        Purchases.shared.getCustomerInfo { [weak self] info, error in
            self?.isPremium = info?.entitlements[Entitlement.premium.rawValue]?.isActive == true
        }
    }

    func showPaywall(from viewController: UIViewController) {
        // RevenueCatUI Paywall表示
    }

    func restorePurchases(completion: @escaping (Bool) -> Void) {
        // 購入の復元
    }
}
```

### 2. 機能制限チェック

#### 制限チェックの例
```swift
// 対象者数の制限チェック
func canAddTargetPerson() -> Bool {
    if SubscriptionManager.shared.isPremium {
        return true
    }
    let currentCount = targetPersons.count
    return currentCount < 3
}

// 制限到達時の処理
func handleLimitReached() {
    let alert = UIAlertController(
        title: "制限に達しました",
        message: "無料版では対象者は3名までです。\nプレミアム版では無制限に追加できます。",
        preferredStyle: .alert
    )
    alert.addAction(UIAlertAction(title: "プレミアムにアップグレード", style: .default) { _ in
        SubscriptionManager.shared.showPaywall(from: self)
    })
    alert.addAction(UIAlertAction(title: "キャンセル", style: .cancel))
    present(alert, animated: true)
}
```

### 3. UI表示の分岐

#### プレミアム限定機能の表示
```swift
func setupUI() {
    if SubscriptionManager.shared.isPremium {
        // プレミアム機能を表示
        statisticsButton.isHidden = false
        exportButton.isHidden = false
    } else {
        // プレミアムバッジを表示
        statisticsButton.isHidden = true
        exportButton.isHidden = true
        showPremiumBadge()
    }
}
```

---

## Paywall デザイン案

### 表示タイミング
1. **制限到達時**: 無料版の制限に達したとき
2. **設定画面から**: 「プレミアムにアップグレード」ボタン
3. **初回起動時**: アプリ起動後2-3回目の使用後（任意）
4. **プレミアム機能タップ時**: プレミアム限定機能にアクセスしたとき

### Paywall 内容
#### タイトル
"プレミアムで全ての機能を解放"

#### 機能一覧
- ✅ 無制限の評価者・対象者・評価項目
- ✅ 無制限のデータ保存
- ✅ 統計・グラフ機能
- ✅ データエクスポート（CSV/PDF）
- ✅ 評価項目テンプレート
- ✅ 一括操作（複数選択・コピー・共有）
- ✅ データバックアップ・同期
- ✅ 優先サポート

#### 価格表示
```
[ ] 月額プラン    ¥480/月
[x] 年間プラン    ¥3,600/年 (37% OFF)

7日間無料トライアル

[  大きなボタン: 無料トライアルを開始  ]

• いつでもキャンセル可能
• 購入の復元
```

---

## プライバシーとコンプライアンス

### App Store審査対応
1. **プライバシーポリシー更新**
   - RevenueCatによるデータ収集について明記
   - サブスクリプション情報の扱い

2. **利用規約**
   - サブスクリプションの自動更新について
   - キャンセルポリシー
   - 返金ポリシー

3. **App Store Product Page**
   - アプリ内課金の種類を明記
   - サブスクリプション説明

### データ保護
- RevenueCatは匿名IDのみ使用
- 個人の測定データは一切外部送信しない
- データはデバイス内（Realm）に保存

---

## マーケティング・コミュニケーション

### App Store 説明文更新
```
【無料版】
基本的な評価機能が使えます
• 対象者3名まで
• 評価項目5項目/対象者まで
• 測定結果10件/項目まで

【プレミアム版】
全ての制限を解除
• 無制限のデータ管理
• 統計・グラフ機能
• データエクスポート
• テンプレート機能
• 優先サポート

7日間無料トライアルで全機能をお試しいただけます。
```

### スクリーンショット
- Before/After（無料版 vs プレミアム版）
- グラフ・統計機能のスクリーンショット
- データエクスポートの例

---

## FAQ（想定される質問）

### Q1: 無料版でも十分使えますか?
A: はい。個人で少数の対象者を評価する場合は無料版で十分です。対象者3名、各5項目、計10回までの測定が可能です。

### Q2: データは消えませんか?
A: デバイス内に保存されます。プレミアム版ではiCloudバックアップも利用可能です。

### Q3: プレミアムを解約したらどうなりますか?
A: データは残りますが、無料版の制限が適用されます。再度アップグレードすれば全データにアクセスできます。

### Q4: 買い切り版はありますか?
A: 年間プランが最もお得ですが、買い切り版もオプションとして検討中です。

### Q5: 領収書は発行できますか?
A: App Storeの購入履歴から領収書を取得できます。

---

## 成功指標（KPI）

### 目標
1. **コンバージョン率**: 無料ユーザーの10%がプレミアムに移行
2. **トライアル→有料転換率**: 30%以上
3. **継続率**: 3ヶ月後に70%以上
4. **LTV（顧客生涯価値）**: 1ユーザーあたり¥5,000以上

### 測定方法
- RevenueCatのダッシュボードで追跡
- App Store Connectのアナリティクス
- カスタムイベント追跡（Firebase/Amplitudeなど）

---

## 次のアクションアイテム

### 即座に実施
- [ ] RevenueCatダッシュボードでアカウント作成
- [ ] App Store Connectでサブスクリプション商品作成
- [ ] プライバシーポリシー・利用規約の作成/更新
- [ ] 価格設定の最終決定

### 実装開始前
- [ ] この仕様書のレビュー・承認
- [ ] 実装スケジュールの作成
- [ ] デザインモックアップの作成（Paywall画面）
- [ ] テスト計画の策定

### 実装中
- [ ] SubscriptionManager実装
- [ ] 機能制限ロジック実装
- [ ] Paywall画面実装
- [ ] サンドボックステスト

### リリース前
- [ ] App Store審査用スクリーンショット準備
- [ ] プロモーション素材作成
- [ ] ベータテスト（TestFlight）
- [ ] 最終動作確認

---

## まとめ

このサブスクリプション仕様により、以下を実現します：

1. **無料ユーザーにも価値提供**: 基本機能は無料で使える
2. **プロフェッショナル向けの強力な機能**: プレミアムで業務効率を大幅に改善
3. **公平な価格設定**: 月額¥480または年額¥3,600で全機能を解放
4. **段階的な実装**: Phase 1から順次機能を追加
5. **測定可能な目標**: KPIで成功を測定

この仕様書をベースに、実装を進めていきましょう。

---

*最終更新: 2025年10月10日*
*バージョン: 1.0*
