# タイマー評価アプリ - 無料版機能追加提案

## 概要

このドキュメントでは、無料版に追加すべき機能の優先順位と実装計画を定義します。
サブスクリプション機能の実装前に、まず無料版の価値を高めることを目的としています。

---

## 基本方針

1. **ユーザーに価値を提供**: 無料版でも十分使える機能を提供
2. **データの安全性**: 医療データなので保護が最優先
3. **使いやすさの向上**: 日常的に使いやすいUX改善
4. **段階的な実装**: 優先度の高いものから順次実装

---

## 機能提案と優先順位

### 🎯 優先度: 最高（すぐ実装すべき）

#### 1. データのバックアップ・復元機能
**価値**: ⭐⭐⭐⭐⭐ 最重要
**実装難易度**: ⭐⭐⭐ 中程度
**理由**: 医療データなので消えると困る。ユーザーの安心感が最重要

**機能詳細**:
- Realmデータを全てJSON形式でエクスポート
- ドキュメントフォルダまたはFiles appへの保存
- JSONファイルからのインポート（復元）
- アプリ再インストール時の復元対応
- 設定画面に「データのバックアップ」「データの復元」ボタン追加

**技術的実装**:
```swift
// エクスポート
- Realm全データをCodable structに変換
- JSONEncoder でファイル出力
- UIActivityViewController で共有

// インポート
- UIDocumentPickerViewController でファイル選択
- JSONDecoder でデータ読み込み
- Realmへ書き込み（重複チェック付き）
```

**画面イメージ**:
```
設定画面
├─ データ管理
   ├─ データをバックアップ  [ボタン]
   └─ データを復元          [ボタン]
```

---

#### 2. 測定時のラップタイム機能
**価値**: ⭐⭐⭐⭐ 高い
**実装難易度**: ⭐⭐⭐⭐ 比較的簡単
**理由**: 1つの動作を途中で記録したいニーズがある

**機能詳細**:
- タイマー実行中に「ラップ」ボタンを追加
- ラップタイムを配列で記録
- 最終的に複数のタイムを一覧表示
- 例: 「歩行」の評価で、5m地点、10m地点のタイムを記録

**データモデル変更**:
```swift
struct TimerAssessment {
    var uuidString = UUID().uuidString
    var resultTimer: Double
    var lapTimes: [Double] = []  // 🆕 追加
    var createdAt: Date? = Date()
    var updatedAt: Date?
}
```

**UI変更**:
```
評価画面（タイマー実行中）
├─ タイマー表示: 00:15:23
├─ [Start] / [Stop] / [Reset]
├─ [Lap] ボタン 🆕
└─ ラップ一覧 🆕
   ├─ Lap 1: 00:05:12
   ├─ Lap 2: 00:10:45
   └─ Lap 3: 00:15:23
```

---

#### 3. データの検索・フィルタリング機能
**価値**: ⭐⭐⭐⭐ 高い
**実装難易度**: ⭐⭐⭐⭐ 比較的簡単
**理由**: 過去データが増えると見つけにくい

**機能詳細**:
- 過去評価一覧画面に検索バーを追加
- 日付範囲指定でフィルタリング
- 測定時間の範囲指定でフィルタリング
- メモ内容での検索（メモ機能実装後）

**UI追加**:
```
過去評価一覧画面
├─ 検索バー 🆕
├─ フィルターボタン 🆕
│  ├─ 日付範囲: [開始日] 〜 [終了日]
│  ├─ 測定時間: [最小] 〜 [最大]
│  └─ [適用] [クリア]
└─ データ一覧
```

---

### 🔥 優先度: 高（価値が高い）

#### 4. 簡易統計表示（無料版でも一部提供）
**価値**: ⭐⭐⭐⭐⭐ 非常に高い
**実装難易度**: ⭐⭐⭐⭐⭐ 非常に簡単
**理由**: 平均値ぐらいは無料でも見たい

**機能詳細**:
- 各評価項目の基本統計を表示
  - 平均値（Average）
  - 最小値（Best/Fastest）
  - 最大値（Slowest）
  - データ数（Count）
- 過去評価一覧画面の上部に表示
- グラフはプレミアム、数値のみは無料

**UI追加**:
```
過去評価一覧画面
├─ 統計サマリー 🆕
│  ├─ 平均: 01分23秒45
│  ├─ 最速: 01分15秒32
│  ├─ 最遅: 01分35秒67
│  └─ 記録数: 15件
└─ データ一覧
```

**実装**:
```swift
func calculateStatistics(for assessments: [TimerAssessment]) -> Statistics {
    let times = assessments.map { $0.resultTimer }
    return Statistics(
        average: times.reduce(0, +) / Double(times.count),
        min: times.min() ?? 0,
        max: times.max() ?? 0,
        count: times.count
    )
}
```

---

#### 5. 測定結果へのメモ機能（簡易版）
**価値**: ⭐⭐⭐⭐⭐ 非常に高い
**実装難易度**: ⭐⭐⭐⭐ 比較的簡単
**理由**: 記録時の状況を残したい

**機能詳細**:
- 測定保存時に短いメモ（100文字程度）を追加可能
- 例: 「杖使用」「介助あり」「雨天」など
- 過去評価一覧でメモも表示
- メモは任意（空でもOK）

**データモデル変更**:
```swift
struct TimerAssessment {
    var uuidString = UUID().uuidString
    var resultTimer: Double
    var memo: String? = nil  // 🆕 追加
    var createdAt: Date? = Date()
    var updatedAt: Date?
}
```

**UI変更**:
```
保存確認アラート
├─ タイトル: "測定完了"
├─ 測定結果: 01分23秒45
├─ メモ入力欄 🆕
│  └─ [テキストフィールド] (オプション)
└─ [保存] [キャンセル]

過去評価一覧（セル）
├─ 測定時間: 01分23秒45
├─ 日時: 2025年10月10日 14:30
└─ メモ: 杖使用 🆕
```

---

#### 6. 最近使った評価項目のクイックアクセス
**価値**: ⭐⭐⭐⭐ 高い
**実装難易度**: ⭐⭐⭐ 中程度
**理由**: 毎回深い階層まで行くのが面倒

**機能詳細**:
- トップ画面（評価者一覧）に「最近の評価」セクション追加
- 最近使用した評価項目への直接アクセス（最大5件）
- タップで即座に評価開始画面へ遷移
- 評価開始までのタップ数を大幅削減（4タップ → 1タップ）

**データ管理**:
```swift
// UserDefaultsで最近使用した評価項目を管理
struct RecentAssessmentItem {
    let assessorUUID: String
    let targetPersonUUID: String
    let assessmentItemUUID: String
    let lastUsedAt: Date
}
```

**UI追加**:
```
評価者一覧画面（トップ）
├─ 最近の評価 🆕
│  ├─ 対象者A - 歩行
│  ├─ 対象者B - 食事
│  └─ 対象者A - 更衣
├─ [区切り線]
└─ 評価者一覧
   ├─ 評価者X
   └─ 評価者Y
```

---

### 💡 優先度: 中（あると便利）

#### 7. ダークモード対応
**価値**: ⭐⭐⭐ 中程度
**実装難易度**: ⭐⭐⭐ 中程度
**理由**: 病院の夜勤帯など暗い場所での使用

**機能詳細**:
- システム設定に従った自動ダークモード
- ライト/ダーク両方で視認性の良いカラー設定
- カスタムカラー（Colors.swift）の見直し

**実装**:
```swift
// Assets.xcassets で Color Set を作成
// Light/Dark appearance別にカラー定義
```

---

#### 8. 音声フィードバック（Start/Stop時）
**価値**: ⭐⭐⭐ 中程度
**実装難易度**: ⭐⭐⭐⭐⭐ 非常に簡単
**理由**: タイマー操作時に画面を見なくても確認できる

**機能詳細**:
- Start時に「ピッ」音
- Stop時に「ピピッ」音
- 設定画面でON/OFF可能
- システムサウンド使用（AVFoundation）

**実装**:
```swift
import AVFoundation

func playSound(_ soundID: SystemSoundID) {
    AudioServicesPlaySystemSound(soundID)
}

// Start時
AudioServicesPlaySystemSound(1104) // Tink.caf

// Stop時
AudioServicesPlaySystemSound(1105) // Tock.caf
```

---

#### 9. カスタム時間アラート
**価値**: ⭐⭐⭐ 中程度
**実装難易度**: ⭐⭐⭐⭐ 比較的簡単
**理由**: 「30秒経過したら知らせて」などのニーズ

**機能詳細**:
- タイマー開始前に任意の秒数を設定可能
- その時間に達したらアラート音 + バイブレーション
- タイマーは継続（停止しない）
- 複数の時間設定も可能

**UI追加**:
```
評価画面
├─ タイマー表示
├─ アラート設定 🆕
│  ├─ [30秒] [1分] [2分] [カスタム]
│  └─ 設定時間: 30秒
└─ [Start] [Stop] [Reset]
```

---

#### 10. 評価項目のアイコン設定
**価値**: ⭐⭐⭐ 中程度
**実装難易度**: ⭐⭐⭐ 中程度
**理由**: 視認性向上

**機能詳細**:
- 各評価項目にアイコンを設定可能
- SF Symbolsから選択
- デフォルトアイコンも用意
- 一覧画面での識別が容易に

**データモデル変更**:
```swift
struct AssessmentItem {
    var uuidString = UUID().uuidString
    var name: String
    var iconName: String? = "timer"  // 🆕 SF Symbol名
}
```

**UI例**:
```
評価項目一覧
├─ 🚶 歩行
├─ 🍽️ 食事
├─ 👔 更衣
└─ 🚿 入浴
```

---

### 🌱 優先度: 低（将来的に）

#### 11. iPad最適化
**価値**: ⭐⭐ 低い（ユーザー次第）
**実装難易度**: ⭐⭐ 高い

- スプリットビュー対応
- 大画面での最適表示
- マルチタスキング対応

---

#### 12. 多言語対応（英語）
**価値**: ⭐⭐ 低い（市場次第）
**実装難易度**: ⭐⭐⭐ 中程度

- Localizable.stringsの作成
- 英語版UI
- 海外ユーザーへの対応

---

#### 13. Apple Watch対応
**価値**: ⭐⭐ 低い（ニッチ）
**実装難易度**: ⭐ 非常に高い

- 手元でタイマー操作
- iPhoneとの同期
- Watch専用UI

---

## 📋 推奨実装順序

### Phase 1: 安心・安全（必須） - 優先度: 最高
**期間**: 2-3週間

1. **データバックアップ・復元**
   - 工数: 5-7日
   - データ保護は最優先
   - JSONエクスポート/インポート

2. **測定結果へのメモ機能**
   - 工数: 2-3日
   - 実用性が高い
   - データモデルに1フィールド追加

3. **簡易統計表示**
   - 工数: 1-2日
   - 実装が簡単で効果大
   - 平均・最小・最大・件数の表示

**Phase 1 完了時の価値**:
- データの安全性確保
- 記録の詳細度UP
- データの可視化

---

### Phase 2: 使いやすさ向上 - 優先度: 高
**期間**: 2-3週間

4. **ラップタイム機能**
   - 工数: 3-5日
   - 差別化要素
   - 複数地点の記録が可能に

5. **最近使った評価項目のクイックアクセス**
   - 工数: 3-4日
   - UX改善
   - タップ数削減（4→1）

6. **データの検索・フィルタリング**
   - 工数: 3-4日
   - データが増えたら必須
   - 日付・時間範囲での絞り込み

**Phase 2 完了時の価値**:
- より詳細な測定
- 操作効率の大幅改善
- データの検索性向上

---

### Phase 3: 細かい改善 - 優先度: 中
**期間**: 1-2週間

7. **音声フィードバック**
   - 工数: 1日
   - 実装が簡単
   - 操作感の向上

8. **カスタム時間アラート**
   - 工数: 2-3日
   - 実装が簡単
   - 測定の利便性UP

9. **ダークモード対応**
   - 工数: 3-4日
   - 標準的な機能
   - 夜間使用に対応

**Phase 3 完了時の価値**:
- 操作性の向上
- 柔軟な測定設定
- 環境に応じた表示

---

### Phase 4: 拡張 - 優先度: 中
**期間**: 1週間

10. **評価項目のアイコン設定**
    - 工数: 3-4日
    - 見た目の改善
    - 視認性向上

**Phase 4 完了時の価値**:
- より直感的なUI
- 評価項目の識別が容易

---

## 💬 最優先推奨（Phase 1）

**まずはPhase 1の3つから始めることを強く推奨します**：

### 1. データバックアップ・復元
→ ユーザーの安心感（医療データなので必須）

### 2. メモ機能
→ 実用性が大幅UP（状況記録が可能に）

### 3. 簡易統計
→ データの価値を実感（平均値など）

**理由**:
- 実装が比較的簡単
- ユーザー満足度が高い
- すぐに価値を実感できる
- リスクが低い（既存機能への影響小）

---

## 技術的考慮事項

### データモデルの拡張
既存のRealmスキーマに以下を追加：
```swift
// TimerAssessment
var memo: String? = nil           // メモ機能用
var lapTimes: [Double] = []       // ラップタイム用

// AssessmentItem
var iconName: String? = "timer"   // アイコン設定用
```

### マイグレーション対応
Realmのスキーマバージョンアップが必要：
```swift
let config = Realm.Configuration(
    schemaVersion: 2,  // バージョンアップ
    migrationBlock: { migration, oldSchemaVersion in
        if oldSchemaVersion < 2 {
            // 新フィールドのデフォルト値設定
        }
    }
)
```

---

## 成功指標（KPI）

### Phase 1
- データバックアップ機能の使用率: 20%以上
- メモ付き保存の割合: 30%以上
- 統計画面の閲覧率: 50%以上

### Phase 2
- ラップタイム機能の使用率: 15%以上
- クイックアクセスからの評価開始: 40%以上
- 検索・フィルタリング使用率: 20%以上

### Phase 3-4
- 音声フィードバックON率: 60%以上
- カスタムアラート設定率: 10%以上
- ダークモード使用率: システム設定に準拠

---

## 次のアクションアイテム

### 即座に実施
- [ ] この提案内容のレビュー・承認
- [ ] Phase 1の実装優先順位の最終決定
- [ ] デザインモックアップの作成（必要に応じて）

### 実装開始前
- [ ] 実装スケジュールの詳細化
- [ ] データモデル変更の詳細設計
- [ ] マイグレーション計画の策定
- [ ] テスト計画の作成

### Phase 1 実装順序（推奨）
1. 簡易統計表示（最も簡単）
2. メモ機能（データモデル変更を先に）
3. データバックアップ・復元（時間がかかる）

---

## まとめ

無料版の機能拡充により、以下を実現：

1. **データの安全性**: バックアップ機能で安心
2. **実用性の向上**: メモ・ラップタイムで詳細記録
3. **使いやすさ**: クイックアクセス・検索で効率化
4. **データの価値**: 統計で測定結果を可視化
5. **段階的な実装**: Phaseごとに価値を提供

この機能追加により、無料版でも十分に価値のあるアプリとなり、
プレミアム版への移行動機も明確になります。

---

*最終更新: 2025年10月10日*
*バージョン: 1.0*
