# TimerAssessmentアプリ改善提案書

## 現状の問題点

### 1. Storyboard依存
- 機能選択画面、タイマー計測画面、評価詳細画面、過去の評価一覧画面がStoryboardに依存
- コードでの柔軟な制御が困難
- レビュー時の差分確認が難しい

### 2. SNS共有ボタンの重複
- 機能選択画面にTwitter、LINE、その他アプリ共有、レビュー依頼ボタンが存在
- 設定画面と機能が重複しており、UI が煩雑
- 本来の機能（評価開始・評価一覧）が目立ちにくい

### 3. 画面遷移の煩雑さ
- 評価者 → 対象者 → 評価項目 → 機能選択 と4階層の遷移が必要
- 深い階層構造により操作が煩雑
- 戻るボタンを何度も押す必要がある

## 改善提案

### 提案A: アコーディオン式UI（推奨）

#### 概要
評価者画面を展開可能なアコーディオン式テーブルビューに変更し、1画面で全階層を表示

#### メリット
✅ 画面遷移が不要になり、操作が直感的
✅ 全体の構造が一目で把握できる
✅ タップ数が大幅に削減される
✅ データの追加・編集も同じ画面で完結

#### 実装イメージ
```
評価者画面（Accordion Style）
├─ 📋 山田太郎（評価者1）[▼]
│   ├─ 👤 佐藤花子（対象者1）[▼]
│   │   ├─ ⏱ 起立動作
│   │   ├─ ⏱ 10m歩行
│   │   └─ ⏱ TUG
│   └─ 👤 鈴木一郎（対象者2）[▶]
├─ 📋 田中次郎（評価者2）[▶]
└─ ➕ 評価者を追加

※ [▼] = 展開中、[▶] = 折りたたみ中
※ 各項目の右側に詳細ボタン（ℹ️）で編集・削除
※ 評価項目タップで機能選択画面へ遷移
```

#### UI構成
1. **3段階のセル**:
   - レベル1: 評価者セル（背景色: 濃い色）
   - レベル2: 対象者セル（背景色: 中間色、インデント付き）
   - レベル3: 評価項目セル（背景色: 薄い色、インデント付き）

2. **展開/折りたたみボタン**:
   - 矢印アイコン（▶/▼）
   - アニメーション付きで滑らかに展開

3. **追加ボタン**:
   - 各レベルに「+ 追加」ボタン
   - または画面右下にフローティングアクションボタン

#### 技術的実装
- `UITableView` with `numberOfRowsInSection` の動的計算
- 展開状態を管理する配列: `expandedAssessors: [UUID]`, `expandedTargetPersons: [UUID]`
- セルの高さとインデントをレベルに応じて調整
- アニメーション: `tableView.reloadSections(_:with: .automatic)`

---

### 提案B: タブバー方式（代替案）

#### 概要
タブバーで「評価者」「対象者」「評価項目」を切り替え、選択状態を維持

#### メリット
✅ 各画面が独立しているため実装が容易
✅ 既存コードの流用が可能

#### デメリット
❌ 全体構造が把握しにくい
❌ タブ切り替えの手間が発生
❌ 選択状態の管理が複雑

---

### 提案C: 現状維持 + 改善（最小限の変更）

#### 概要
現在の3画面構成は維持し、以下の改善のみ実施
- Storyboardをプログラマティックに変更
- SNS共有ボタンを削除

#### メリット
✅ 実装工数が少ない
✅ 既存のUXを維持

#### デメリット
❌ 画面遷移の煩雑さは解消されない

---

## 推奨する改善計画

### フェーズ1: 既存画面の脱Storyboard化とクリーンアップ（優先度: 高）
1. ✅ 機能選択画面の脱Storyboard化
2. ✅ 機能選択画面からSNS共有ボタンを削除（設定画面のみに集約）
3. ✅ タイマー計測画面の脱Storyboard化
4. ✅ 評価詳細画面の脱Storyboard化
5. ✅ 過去の評価一覧画面の脱Storyboard化

**期待効果**:
- コードの保守性向上
- UIの統一感向上
- 設定画面への機能集約

---

### フェーズ2: アコーディオン式UIの実装（優先度: 中）
1. 評価者画面のTableViewを3段階対応に変更
2. 展開/折りたたみロジックの実装
3. セルデザインの階層表現（インデント、背景色）
4. アニメーション実装
5. 既存の対象者画面・評価項目画面を統合

**期待効果**:
- 操作性の大幅向上
- 画面遷移の削減
- ユーザー体験の改善

---

## その他の改善提案

### 1. 設定画面の強化
- ✅ 既に実装済み
- アプリURLの更新が必要（現在プレースホルダー）
- 問い合わせメールアドレスの更新が必要

### 2. データ永続化の確認
- UserDefaults or CoreData or Realm の使用状況確認
- データバックアップ機能の検討

### 3. アクセシビリティ
- VoiceOver対応
- Dynamic Type対応
- ダークモード対応

### 4. エラーハンドリング
- データロード失敗時の処理
- ネットワークエラー時の処理

### 5. パフォーマンス
- TableViewのセル再利用最適化
- 大量データでの動作確認

---

## 実装の優先順位

### 🔴 Phase 1（即実施）: 脱Storyboard化 + SNS共有削除
**期間**: 2-3時間
**理由**:
- コードの保守性が大幅に向上
- UIの統一感が生まれる
- 後続の変更がしやすくなる

### 🟡 Phase 2（検討後実施）: アコーディオン式UI
**期間**: 4-6時間
**理由**:
- UX改善効果が非常に高い
- ただし大きな設計変更を伴う
- ユーザーテストが必要

**判断基準**:
- 現在のユーザー数が多い → 段階的移行
- まだユーザーが少ない → 一気に変更

### 🟢 Phase 3（将来的に）: その他の改善
**期間**: 案件ごと
**理由**:
- 必須ではないが、あると良い機能
- リリース後のフィードバックを見て判断

---

## 質問事項（ユーザーへ）

1. **アコーディオン式UIの採用について**
   - 採用する → Phase 2も実施
   - 見送る → Phase 1のみ実施

2. **既存ユーザーの有無**
   - いる → 段階的移行を検討
   - いない → 一気に変更可能

3. **リリース時期**
   - 急ぎ → Phase 1のみ
   - 時間がある → Phase 1 + Phase 2

4. **その他の要望**
   - データエクスポート機能
   - グラフ表示機能
   - 複数端末での同期機能
   - など

---

## 次のアクション

**まず Phase 1 を実施します**:
1. ✅ 機能選択画面の脱Storyboard化
2. ✅ SNS共有ボタン削除
3. ✅ タイマー計測画面の脱Storyboard化
4. ✅ 評価詳細画面の脱Storyboard化
5. ✅ 過去の評価一覧画面の脱Storyboard化

その後、アコーディオン式UIの実装について判断します。
